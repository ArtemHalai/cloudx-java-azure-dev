<!doctype html>
<html lang="en">

<head lang="en" th:replace="~{fragments/head :: head}"></head>

<body>
<div lang="en" th:replace="~{fragments/header :: header}"></div>
<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
	<h1 class="display-4">Shopping Cart Summary</h1>

	<div class="alert alert-danger" role="alert" th:if="${error}">
		<span th:text="${error}"></span>
	</div>
	<div class="alert alert-secondary text-left" style="white-space: pre-wrap; font-size: 0.9em;"
		 th:if="${stacktrace}">
		<code style="padding-left: 0; display: block;" th:text="${stacktrace}"></code>
	</div>

	<h2 class="subHeader" th:if="${userLoggedIn} != true">You need to
		log in before placing your order</h2>
	<p th:if="${order} == null or ${order.products} == null or (${order.products} != null and ${order.products.size} == 0)">
		Your shopping cart is empty, add some products!
	</p>

	<div class="container"
		 th:if="${order} != null and ${order.complete} != true and ${order.products} != null and ${order.products.size} > 0">
		<div class="row fw-bold mb-3 text-center">
			<div class="col-2 fullTable">Product ID</div>
			<div class="col-4">Description</div>
			<div class="col-3 fullTable">Product Name</div>
			<div class="col-3">Quantity</div>
		</div>

		<div class="row align-items-center mb-3 text-center" th:each="product, iStat : ${order.products}">
			<div class="col-2 fullTable">
				<span th:text="${product.id}"></span>
			</div>
			<div class="col-4">
				<figure class="mb-0">
					<img alt="Product image" class="thumbnail" style="max-width: 100px; height: auto;"
						 th:src="@{${product.photoURL}}"/>
				</figure>
			</div>
			<div class="col-3 fullTable">
				<span th:text="${product.name}"></span>
			</div>
			<div class="col-3">
				<div class="d-flex justify-content-center align-items-center">
					<button class="btn btn-outline-primary btn-sm me-2" th:onclick="'updatecart(\'' + ${product.id} + '\' , \'minus\');'"
							type="button">-
					</button>
					<span class="mx-2" th:text="${product.quantity}"></span>
					<button class="btn btn-outline-primary btn-sm ms-2" th:onclick="'updatecart(\'' + ${product.id} + '\' , \'plus\');'"
							type="button">+
					</button>
				</div>
			</div>
		</div>
	</div>

	<div class="text-center mt-3"
		 th:if="${userLoggedIn} == true and ${order} != null and ${order.products} != null and ${order.products.size} > 0 and ${order.complete} != true">
		<a style="font-weight: bold; text-decoration: none; color: black;" th:onclick="'completecart();'">
			<button class="btn btn-outline-primary btn-lg" type="button">Complete Order</button>
		</a>
	</div>

	<div style="display: flex; justify-content: center;" th:if="${order} != null and ${order.complete} == true">
		<div class="text-center">
			<h2 class="subHeader">Congratulations, your order is now complete and being processed!</h2>
		</div>
	</div>

	<form action="updatecart" id="updatecart" method="post">
		<input th:if="${_csrf}" th:name="${_csrf.parameterName}"
			   th:value="${_csrf.token}" type="hidden"/>
		<input id="productId" name="productId" type="hidden" value="">
		<input id="operator" name="operator" type="hidden" value="">
	</form>
	<form action="completecart" id="completecart" method="post">
		<input th:if="${_csrf}" th:name="${_csrf.parameterName}"
			   th:value="${_csrf.token}" type="hidden"/>
	</form>
</div>
<div lang="en" th:replace="~{fragments/footer :: footer}"></div>
<div lang="en" th:replace="~{fragments/disclaimer :: disclaimer}"></div>
<script>
	function updatecart(productId, operator) {
		document.getElementById('productId').value = productId;
		document.getElementById('operator').value = operator;
		document.getElementById('updatecart').submit();
	}
	function completecart() {
		document.getElementById('completecart').submit();
	}
</script>
</body>

</html>